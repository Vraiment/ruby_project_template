#!/usr/bin/env ruby
# frozen_string_literal: true

#
# This file was generated by Bundler.
#
# The application 'rake' is installed as part of a gem, and
# this file is here to facilitate running it.
#

ENV['BUNDLE_GEMFILE'] ||= File.expand_path('../Gemfile', __dir__)

require 'rubygems'
require 'bundler/setup'
require 'erb'

TEMPLATES = %w[
  gemspec.erb
  README.erb
].freeze

def write_template(template_path) # rubocop:disable Metrics/MethodLength
  template = File.read(template_path)

  puts ERB.new(template, trim_mode: '-').result_with_hash(
    gem_name: 'some_gem',
    author: 'myself',
    email: 'nobody@nowhere.com',
    summary: 'Some gem',
    homepage: 'http://localhost'
  )
rescue StandardError
  warn "Failed to instantiate template #{template_path}"

  raise
end

TEMPLATES
  .map { |template_name| File.join('..', template_name) }
  .map { |template_rel_path| File.expand_path(template_rel_path, __dir__) }
  .map { |template_abs_path| write_template(template_abs_path) }
